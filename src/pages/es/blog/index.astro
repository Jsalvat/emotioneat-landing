---
import BlogLayout from '../../../layouts/BlogLayout.astro';
import { supabase } from '../../../lib/supabase';
import es from '../../../i18n/es.json';

// Language is Spanish
const lang: 'en' | 'es' = 'es';
const t = es;

// Fetch blog posts with bilingual fields
let posts: any[] = [];
try {
	if (supabase) {
		const { data, error } = await supabase
			.from('blog_posts')
			.select(`
				id,
				slug,
				published_at,
				reading_time,
				cover_image_url,
				title_en,
				title_es,
				excerpt_en,
				excerpt_es
			`)
			.eq('status', 'published')
			.order('published_at', { ascending: false});

		if (error) {
			console.error('Error fetching blog posts:', error);
		} else {
			// Localize posts for Spanish
			posts = (data || []).map((post: any) => ({
				...post,
				title: post.title_es || post.title_en || '',
				excerpt: post.excerpt_es || post.excerpt_en || ''
			}));
		}
	} else {
		console.warn('Supabase not configured - showing empty blog');
	}
} catch (error) {
	console.error('Error connecting to Supabase:', error);
}

// SEO Meta
const title = 'Blog | EmotionEat - Consejos sobre Alimentaci√≥n Emocional';
const description = 'Descubre consejos expertos sobre alimentaci√≥n emocional, estrategias para controlar los atracones y mejorar tu relaci√≥n con la comida.';
---

<BlogLayout
	title={title}
	description={description}
	lang={lang}
>
	<!-- Hero Section -->
	<section class="bg-gradient-to-br from-blue-50 to-indigo-100 py-20">
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
			<div class="text-center">
				<h1 class="text-4xl md:text-6xl font-bold text-gray-900 mb-6">
					Blog de Alimentaci√≥n Emocional
				</h1>
				<p class="text-xl text-gray-600 max-w-3xl mx-auto leading-relaxed">
					Consejos expertos, estrategias pr√°cticas y apoyo profesional para superar la alimentaci√≥n emocional y crear una relaci√≥n saludable con la comida.
				</p>
			</div>
		</div>
	</section>

	<!-- Blog Posts Grid -->
	<section class="py-16 bg-white">
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
			{posts && posts.length > 0 ? (
				<div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
					{posts.map((post) => (
						<article class="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300 border border-gray-100">
							{post.cover_image_url && (
								<div class="aspect-video overflow-hidden">
									<img
										src={post.cover_image_url}
										alt={post.title}
										class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
										loading="lazy"
									/>
								</div>
							)}
							<div class="p-6">
								<div class="flex items-center text-sm text-gray-500 mb-3">
									<time datetime={post.published_at}>
										{new Date(post.published_at).toLocaleDateString('es-ES', {
											year: 'numeric',
											month: 'long',
											day: 'numeric'
										})}
									</time>
									{post.reading_time && (
										<>
											<span class="mx-2">‚Ä¢</span>
											<span>{post.reading_time} min read</span>
										</>
									)}
								</div>

								<h2 class="text-xl font-bold text-gray-900 mb-3 line-clamp-2">
									<a
										href={`/es/blog/${post.slug}`}
										class="hover:text-blue-600 transition-colors"
									>
										{post.title}
									</a>
								</h2>

								{post.excerpt && (
									<p class="text-gray-600 line-clamp-3 mb-4">
										{post.excerpt}
									</p>
								)}

								<a
									href={`/es/blog/${post.slug}`}
									class="inline-flex items-center text-blue-600 font-medium hover:text-blue-800 transition-colors"
								>
									Leer m√°s
									<svg class="ml-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
									</svg>
								</a>
							</div>
						</article>
					))}
				</div>
			) : (
				<div class="text-center py-16">
					<div class="text-6xl mb-4">üìù</div>
					<h3 class="text-2xl font-bold text-gray-900 mb-4">
						Pr√≥ximamente
					</h3>
					<p class="text-gray-600 max-w-md mx-auto">
						Estamos trabajando en contenido incre√≠ble sobre alimentaci√≥n emocional. ¬°Vuelve pronto!
					</p>
				</div>
			)}
		</div>
	</section>

	<!-- CTA Section -->
	<section class="bg-gradient-to-r from-blue-600 to-indigo-700 py-16">
		<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
			<h2 class="text-3xl font-bold text-white mb-4">
				¬øListo para Cambiar tu Relaci√≥n con la Comida?
			</h2>
			<p class="text-xl text-blue-100 mb-8">
				√önete a miles de personas que est√°n construyendo h√°bitos m√°s sanos, una conversaci√≥n a la vez.
			</p>
			<a
				href={import.meta.env.PUBLIC_APP_URL || 'https://app.emotioneat.com'}
				class="inline-flex items-center px-8 py-4 bg-white text-blue-600 font-semibold rounded-lg hover:bg-gray-50 transition-colors shadow-lg"
			>
				Empezar Ahora
				<svg class="ml-2 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
				</svg>
			</a>
		</div>
	</section>
</BlogLayout>

<style>
	.line-clamp-2 {
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}

	.line-clamp-3 {
		display: -webkit-box;
		-webkit-line-clamp: 3;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}
</style>
