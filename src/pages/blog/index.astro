---
import BlogLayout from '../../layouts/BlogLayout.astro';
import { supabase } from '../../lib/supabase';
import en from '../../i18n/en.json';

// Language is English for this page
const lang: 'en' | 'es' = 'en';
const t = en;

// Fetch blog posts
let posts = [];
try {
	if (supabase) {
		const { data, error } = await supabase
			.from('blog_posts')
			.select('*')
			.eq('status', 'published')
			.order('published_at', { ascending: false });

		if (error) {
			console.error('Error fetching blog posts:', error);
		} else {
			posts = data || [];
		}
	} else {
		console.warn('Supabase not configured - showing empty blog');
	}
} catch (error) {
	console.error('Error connecting to Supabase:', error);
}

// SEO Meta
const title = lang === 'es' ? 'Blog | EmotionEat - Consejos sobre Alimentaci√≥n Emocional' : 'Blog | EmotionEat - Emotional Eating Tips & Advice';
const description = lang === 'es'
	? 'Descubre consejos expertos sobre alimentaci√≥n emocional, estrategias para controlar los atracones y mejorar tu relaci√≥n con la comida.'
	: 'Discover expert tips on emotional eating, strategies to control binge eating, and improve your relationship with food.';
---

<BlogLayout
	title={title}
	description={description}
	lang={lang}
>
	<!-- Hero Section -->
	<section class="bg-gradient-to-br from-blue-50 to-indigo-100 py-20">
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
			<div class="text-center">
				<h1 class="text-4xl md:text-6xl font-bold text-gray-900 mb-6">
					{lang === 'es' ? 'Blog de Alimentaci√≥n Emocional' : 'Emotional Eating Blog'}
				</h1>
				<p class="text-xl text-gray-600 max-w-3xl mx-auto leading-relaxed">
					{lang === 'es'
						? 'Consejos expertos, estrategias pr√°cticas y apoyo profesional para superar la alimentaci√≥n emocional y crear una relaci√≥n saludable con la comida.'
						: 'Expert tips, practical strategies, and professional support to overcome emotional eating and create a healthy relationship with food.'
					}
				</p>
			</div>
		</div>
	</section>

	<!-- Blog Posts Grid -->
	<section class="py-16 bg-white">
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
			{posts && posts.length > 0 ? (
				<div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
					{posts.map((post) => (
						<article class="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300 border border-gray-100">
							{post.cover_image_url && (
								<div class="aspect-video overflow-hidden">
									<img
										src={post.cover_image_url}
										alt={post.title}
										class="w-full h-full object-cover hover:scale-105 transition-transform duration-300"
										loading="lazy"
									/>
								</div>
							)}
							<div class="p-6">
								<div class="flex items-center text-sm text-gray-500 mb-3">
									<time datetime={post.published_at}>
										{new Date(post.published_at).toLocaleDateString(lang === 'es' ? 'es-ES' : 'en-US', {
											year: 'numeric',
											month: 'long',
											day: 'numeric'
										})}
									</time>
									{post.reading_time && (
										<>
											<span class="mx-2">‚Ä¢</span>
											<span>{post.reading_time} min read</span>
										</>
									)}
								</div>

								<h2 class="text-xl font-bold text-gray-900 mb-3 line-clamp-2">
									<a
										href={`/blog/emotional-eating-how-to-identify-and-overcome-it`}
										class="hover:text-blue-600 transition-colors"
									>
										Emotional Eating: How to Identify and Overcome It
									</a>
								</h2>

								<p class="text-gray-600 line-clamp-3 mb-4">
									Discover what emotional eating is, its warning signs, physical and emotional consequences, and practical strategies to create a healthy relationship with food.
								</p>

								<a
									href={`/blog/emotional-eating-how-to-identify-and-overcome-it`}
									class="inline-flex items-center text-blue-600 font-medium hover:text-blue-800 transition-colors"
								>
									{lang === 'es' ? 'Leer m√°s' : 'Read more'}
									<svg class="ml-2 w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
									</svg>
								</a>
							</div>
						</article>
					))}
				</div>
			) : (
				<div class="text-center py-16">
					<div class="text-6xl mb-4">üìù</div>
					<h3 class="text-2xl font-bold text-gray-900 mb-4">
						{lang === 'es' ? 'Pr√≥ximamente' : 'Coming Soon'}
					</h3>
					<p class="text-gray-600 max-w-md mx-auto">
						{lang === 'es'
							? 'Estamos trabajando en contenido incre√≠ble sobre alimentaci√≥n emocional. ¬°Vuelve pronto!'
							: 'We\'re working on amazing content about emotional eating. Check back soon!'
						}
					</p>
				</div>
			)}
		</div>
	</section>

	<!-- CTA Section -->
	<section class="bg-gradient-to-r from-blue-600 to-indigo-700 py-16">
		<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
			<h2 class="text-3xl font-bold text-white mb-4">
				{lang === 'es' ? '¬øListo para Cambiar tu Relaci√≥n con la Comida?' : 'Ready to Change Your Relationship with Food?'}
			</h2>
			<p class="text-xl text-blue-100 mb-8">
				{lang === 'es'
					? '√önete a miles de personas que ya han transformado su alimentaci√≥n emocional con EmotionEat.'
					: 'Join thousands of people who have already transformed their emotional eating with EmotionEat.'
				}
			</p>
			<a
				href={`/${lang === 'en' ? '' : lang}#pricing`}
				class="inline-flex items-center px-8 py-4 bg-white text-blue-600 font-semibold rounded-lg hover:bg-gray-50 transition-colors shadow-lg"
			>
				{lang === 'es' ? 'Empieza tu Transformaci√≥n' : 'Start Your Transformation'}
				<svg class="ml-2 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"></path>
				</svg>
			</a>
		</div>
	</section>
</BlogLayout>

<style>
	.line-clamp-2 {
		display: -webkit-box;
		-webkit-line-clamp: 2;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}

	.line-clamp-3 {
		display: -webkit-box;
		-webkit-line-clamp: 3;
		-webkit-box-orient: vertical;
		overflow: hidden;
	}
</style>