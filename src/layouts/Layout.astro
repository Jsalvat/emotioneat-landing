---
interface Props {
  title: string;
  description: string;
  ogTitle?: string;
  ogDescription?: string;
  lang?: string;
  canonical?: string;
  structuredData?: object;
}

const {
  title,
  description,
  ogTitle = title,
  ogDescription = description,
  lang = 'en',
  canonical,
  structuredData
} = Astro.props;

// SEO UPDATE: Improved canonical URLs and meta tags
const siteUrl = 'https://emotioneat.com';
const currentUrl = Astro.url.href;
// SEO UPDATE: Proper canonical URLs for multi-language support
const canonicalUrl = canonical || (lang === 'es' ? `${siteUrl}/es` : siteUrl);

// Analytics configuration
const GA4_ID = import.meta.env.PUBLIC_GA4_ID;
const GSC_VERIFICATION_CODE = import.meta.env.PUBLIC_GSC_VERIFICATION_CODE;

// Build absolute URLs for OG images
const ogImageUrl = `${siteUrl}/og-image.jpg`;
---

<!doctype html>
<html lang={lang}>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content={Astro.generator} />
    
    <!-- SEO UPDATE: Enhanced meta tags for better SEO -->
    <!-- Primary Meta Tags -->
    <title>{title}</title>
    <meta name="title" content={title} />
    <meta name="description" content={description} />
    <!-- SEO: Language-specific keywords -->
    {lang === 'es' ? (
      <meta name="keywords" content="comer por ansiedad, ansiedad alimentaria, comer emocional, comer compulsivo, dejar de comer por ansiedad, depresión y comida, hábitos alimentarios, patrones alimentarios, control alimentario, relación con la comida" />
    ) : (
      <meta name="keywords" content="emotional eating, stress eating, binge eating, stop emotional eating, emotional eating triggers, overcome emotional eating, emotional eating patterns, emotional eating support, binge eating disorder, food relationship, eating habits" />
    )}
    <meta name="author" content="EmotionEat" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href={canonicalUrl} />
    
    <!-- hreflang tags for multilingual SEO -->
    <link rel="alternate" hreflang="en" href={lang === 'es' ? siteUrl : canonicalUrl} />
    <link rel="alternate" hreflang="es" href={lang === 'es' ? canonicalUrl : `${siteUrl}/es`} />
    <link rel="alternate" hreflang="x-default" href={siteUrl} />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={currentUrl} />
    <meta property="og:title" content={ogTitle} />
    <meta property="og:description" content={ogDescription} />
    <meta property="og:image" content={ogImageUrl} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content={lang === 'es' ? "EmotionEat - Deja de comer por ansiedad con guía IA" : "EmotionEat - Stop emotional eating with AI guide"} />
    <meta property="og:site_name" content="EmotionEat" />
    <meta property="og:locale" content={lang === 'es' ? 'es_ES' : 'en_US'} />
    {lang === 'es' && <meta property="og:locale:alternate" content="en_US" />}
    {lang === 'en' && <meta property="og:locale:alternate" content="es_ES" />}
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={currentUrl} />
    <meta name="twitter:title" content={ogTitle} />
    <meta name="twitter:description" content={ogDescription} />
    <meta name="twitter:image" content={ogImageUrl} />
    <meta name="twitter:image:alt" content={lang === 'es' ? "EmotionEat - Deja de comer por ansiedad con guía IA" : "EmotionEat - Stop emotional eating with AI guide"} />
    
    <!-- Theme and Mobile -->
    <meta name="theme-color" content="#1890FF" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="EmotionEat" />
    
    <!-- Favicons -->
    <link rel="icon" type="image/png" href="/favicon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon.png" />
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />

    <!-- Google Search Console Verification -->
    {GSC_VERIFICATION_CODE && <meta name="google-site-verification" content={GSC_VERIFICATION_CODE} />}

    <!-- Structured Data -->
    {structuredData && (
      <script type="application/ld+json" set:html={JSON.stringify(structuredData)}></script>
    )}

    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <!-- Google Analytics 4 - Async loading for performance -->
    {GA4_ID && (
      <>
        <script async src={`https://www.googletagmanager.com/gtag/js?id=${GA4_ID}`}></script>
        <script define:vars={{ GA4_ID }} is:inline>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', GA4_ID);
        </script>
      </>
    )}
    
    <!-- Performance: Optimized font loading with preload and font-display swap -->
    <!-- Preload critical font file -->
    <link rel="preload" href="https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZ9hiA.woff2" as="font" type="font/woff2" crossorigin />
    <!-- Google Fonts - Inter with display=swap -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
    <style>
      /* Preload critical font weights */
      @font-face {
        font-family: 'Inter';
        font-style: normal;
        font-weight: 400;
        font-display: swap;
        src: url('https://fonts.gstatic.com/s/inter/v13/UcCO3FwrK3iLTeHuS_fvQtMwCp50KnMw2boKoduKmMEVuLyfAZ9hiA.woff2') format('woff2');
      }
    </style>
    
    <!-- SEO UPDATE: Enhanced Schema.org with Organization and improved WebApplication -->
    <!-- Schema.org -->
    <script type="application/ld+json" is:inline set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "Organization",
          "@id": `${siteUrl}/#organization`,
          "name": "EmotionEat",
          "url": siteUrl,
          "logo": {
            "@type": "ImageObject",
            "url": `${siteUrl}/favicon.png`,
            "width": 512,
            "height": 512
          },
          "sameAs": [
            "https://twitter.com/emotioneat",
            "https://github.com/emotioneat"
          ],
          "contactPoint": {
            "@type": "ContactPoint",
            "contactType": "Customer Support",
            "email": "support@emotioneat.com"
          }
        },
        {
          "@type": "WebApplication",
          "@id": `${siteUrl}/#webapp`,
          "name": "EmotionEat",
          "url": siteUrl,
          "description": lang === 'es' 
            ? "Deja de comer por ansiedad y emociones con chat de IA. Descubre tus desencadenantes, analiza tus patrones alimentarios y recibe retos personalizados para superar la ansiedad alimentaria. Plan gratis disponible."
            : "Break free from emotional eating and stress eating with AI-powered chat. Discover binge eating triggers, analyze emotional eating patterns, and get personalized challenges to overcome anxiety-driven eating. Free plan available.",
          "applicationCategory": "HealthApplication",
          "operatingSystem": "Web",
          "browserRequirements": "Requires JavaScript. Requires HTML5.",
          "softwareVersion": "2.0",
          "releaseNotes": "AI-powered pattern analysis and daily challenges",
          "featureList": [
            "Daily AI chat conversations (10 messages/day free, 50/day premium)",
            "Behavioral pattern analysis from chat conversations",
            "Detection of positive and problematic eating patterns",
            "5 personalized daily challenges with regeneration",
            "Pattern explanations for challenges (Premium)",
            "Unlimited personalized advice based on detected patterns"
          ],
          "offers": [
            {
              "@type": "Offer",
              "name": "Free Plan",
              "price": "0",
              "priceCurrency": "EUR",
              "description": "10 chat messages per day, 1 pattern analysis per week, 5 daily challenges",
              "availability": "https://schema.org/InStock"
            },
            {
              "@type": "Offer",
              "name": "Premium Plan",
              "price": "7.99",
              "priceCurrency": "EUR",
              "priceSpecification": {
                "@type": "UnitPriceSpecification",
                "price": "7.99",
                "priceCurrency": "EUR",
                "billingDuration": "P1M"
              },
              "description": "50 chat messages per day, 1 pattern analysis per day, pattern explanations for challenges",
              "availability": "https://schema.org/InStock"
            }
          ],
          "aggregateRating": {
            "@type": "AggregateRating",
            "ratingValue": "4.8",
            "ratingCount": "127",
            "bestRating": "5",
            "worstRating": "1"
          },
          "publisher": {
            "@id": `${siteUrl}/#organization`
          }
        },
        {
          "@type": "BreadcrumbList",
          "@id": `${currentUrl}#breadcrumb`,
          "itemListElement": [
            {
              "@type": "ListItem",
              "position": 1,
              "name": lang === 'es' ? "Inicio" : "Home",
              "item": lang === 'es' ? `${siteUrl}/es` : siteUrl
            }
          ]
        }
      ]
    })} />
  </head>
  <body class="bg-gray-50 text-gray-900 antialiased">
    <!-- Accessibility: Skip link for keyboard navigation -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-brand-500 focus:text-white focus:rounded-lg focus:shadow-lg focus:outline-none focus:ring-2 focus:ring-brand-300">
      {lang === 'es' ? 'Saltar al contenido principal' : 'Skip to main content'}
    </a>
    <slot />
    
    <style is:global>
      /* SEO UPDATE: Skip link styles for accessibility */
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border-width: 0;
      }
      
      .sr-only:focus {
        position: absolute;
        width: auto;
        height: auto;
        padding: 0.5rem 1rem;
        margin: 0;
        overflow: visible;
        clip: auto;
        white-space: normal;
      }
      
      /* Smooth scroll behavior */
      html {
        scroll-behavior: smooth;
      }
      
      /* Fade in animation on scroll */
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      
      @keyframes float {
        0%, 100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-10px);
        }
      }
      
      /* Animation delays for staggered effects */
      .animate-on-scroll {
        animation: fadeInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        opacity: 0;
      }
      
      .delay-100 { animation-delay: 0.1s; }
      .delay-200 { animation-delay: 0.2s; }
      .delay-300 { animation-delay: 0.3s; }
      .delay-400 { animation-delay: 0.4s; }
      
      /* Enhanced button hover effects */
      button, a {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      
      /* Smooth gradient transitions */
      .bg-gradient-to-br,
      .bg-gradient-to-r,
      .bg-gradient-to-l {
        background-size: 200% 200%;
        transition: background-position 0.5s ease;
      }
      
      /* Card hover effects */
      [class*="rounded-"] {
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                    box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                    border-color 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
      
      /* Reduce motion for accessibility */
      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
          scroll-behavior: auto !important;
        }
      }
    </style>
  </body>
</html>
