---
interface Props {
  title: string;
  description: string;
  ogTitle?: string;
  ogDescription?: string;
  canonical?: string;
  structuredData?: object;
}

const {
  title,
  description,
  ogTitle = title,
  ogDescription = description,
  canonical,
  structuredData
} = Astro.props;

const siteUrl = 'https://emotioneat.com';
const currentUrl = Astro.url.href;
const canonicalUrl = canonical || siteUrl;

// Analytics configuration
const GA4_ID = import.meta.env.PUBLIC_GA4_ID;
const GTM_ID = import.meta.env.PUBLIC_GTM_ID;
const GSC_VERIFICATION_CODE = import.meta.env.PUBLIC_GSC_VERIFICATION_CODE;

const ogImageUrl = `${siteUrl}/og_emotionEat.png`;
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content={Astro.generator} />

    <!-- Primary Meta Tags -->
    <title>{title}</title>
    <meta name="title" content={title} />
    <meta name="description" content={description} />
    <meta name="keywords" content="emotional eating, stress eating, binge eating, stop emotional eating, emotional eating triggers, overcome emotional eating, emotional eating patterns, emotional eating support, binge eating disorder, food relationship, eating habits" />
    <meta name="author" content="EmotionEat" />
    <meta name="robots" content="index, follow" />
    <link rel="canonical" href={canonicalUrl} />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={currentUrl} />
    <meta property="og:title" content={ogTitle} />
    <meta property="og:description" content={ogDescription} />
    <meta property="og:image" content={ogImageUrl} />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />
    <meta property="og:image:alt" content="EmotionEat - Stop emotional eating with AI guide" />
    <meta property="og:site_name" content="EmotionEat" />
    <meta property="og:locale" content="en_US" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content={currentUrl} />
    <meta name="twitter:title" content={ogTitle} />
    <meta name="twitter:description" content={ogDescription} />
    <meta name="twitter:image" content={ogImageUrl} />
    <meta name="twitter:image:alt" content="EmotionEat - Stop emotional eating with AI guide" />

    <!-- Theme and Mobile -->
    <meta name="theme-color" content="#E8847C" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="EmotionEat" />

    <!-- Favicons -->
    <link rel="icon" type="image/png" href="/favicon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/favicon.png" />

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" />

    <!-- Google Search Console Verification -->
    {GSC_VERIFICATION_CODE && <meta name="google-site-verification" content={GSC_VERIFICATION_CODE} />}

    <!-- Structured Data -->
    {structuredData && (
      <script type="application/ld+json" is:inline set:html={JSON.stringify(structuredData)}></script>
    )}

    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://www.googletagmanager.com" />

    <!-- Google Tag Manager -->
    {GTM_ID && (
      <script is:inline set:html={`(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','${GTM_ID}');`}></script>
    )}

    <!-- Google Analytics 4 -->
    {GA4_ID && !GTM_ID && (
      <>
        <script is:inline async src={`https://www.googletagmanager.com/gtag/js?id=${GA4_ID}`}></script>
        <script is:inline define:vars={{ GA4_ID }}>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', GA4_ID);
        </script>
      </>
    )}

    <!-- Datafast Analytics -->
    <script
      defer
      data-website-id="dfid_5fOFqpIG8dhL9J7BbZK0f"
      data-domain="emotioneat.com"
      src="https://datafa.st/js/script.js"
      is:inline>
    </script>

    <!-- Google Fonts - Plus Jakarta Sans -->
    <link rel="preload" href="https://fonts.gstatic.com/s/plusjakartasans/v8/LDIbaomQNQcsA88c7O9yZ4KMCoOg4IA6-91aHEjcWuA_qU79TR_V.woff2" as="font" type="font/woff2" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet" />

    <!-- Schema.org -->
    <script type="application/ld+json" is:inline set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "Organization",
          "@id": `${siteUrl}/#organization`,
          "name": "EmotionEat",
          "url": siteUrl,
          "logo": {
            "@type": "ImageObject",
            "url": `${siteUrl}/favicon.png`,
            "width": 512,
            "height": 512
          },
          "sameAs": [
            "https://twitter.com/emotioneat",
            "https://github.com/emotioneat"
          ],
          "contactPoint": {
            "@type": "ContactPoint",
            "contactType": "Customer Support",
            "email": "support@emotioneat.com"
          }
        },
        {
          "@type": "WebApplication",
          "@id": `${siteUrl}/#webapp`,
          "name": "EmotionEat",
          "url": siteUrl,
          "description": "Break free from emotional eating with AI-powered chat. Discover your triggers, analyze your eating patterns, and get personalized challenges to build a healthier relationship with food.",
          "applicationCategory": "HealthApplication",
          "operatingSystem": "Web",
          "browserRequirements": "Requires JavaScript. Requires HTML5.",
          "softwareVersion": "2.0",
          "releaseNotes": "AI-powered pattern analysis and daily challenges",
          "featureList": [
            "Daily AI chat conversations",
            "Behavioral pattern analysis from chat conversations",
            "Detection of positive and problematic eating patterns",
            "5 personalized daily challenges",
            "Pattern explanations for challenges",
            "Personalized advice based on detected patterns"
          ],
          "offers": [
            {
              "@type": "Offer",
              "name": "Free Plan",
              "price": "0",
              "priceCurrency": "USD",
              "description": "10 chat messages per day, 1 pattern analysis per week, 5 daily challenges",
              "availability": "https://schema.org/InStock"
            },
            {
              "@type": "Offer",
              "name": "Premium Plan",
              "price": "7.99",
              "priceCurrency": "USD",
              "priceSpecification": {
                "@type": "UnitPriceSpecification",
                "price": "7.99",
                "priceCurrency": "USD",
                "billingDuration": "P1M"
              },
              "description": "50 chat messages per day, daily pattern analysis, pattern explanations for challenges",
              "availability": "https://schema.org/InStock"
            }
          ],
          "publisher": {
            "@id": `${siteUrl}/#organization`
          }
        },
        {
          "@type": "BreadcrumbList",
          "@id": `${currentUrl}#breadcrumb`,
          "itemListElement": [
            {
              "@type": "ListItem",
              "position": 1,
              "name": "Home",
              "item": siteUrl
            }
          ]
        }
      ]
    })} />
  </head>
  <body class="bg-neutral-50 text-neutral-900 antialiased">
    <!-- Google Tag Manager (noscript) -->
    {GTM_ID && (
      <noscript>
        <iframe src={`https://www.googletagmanager.com/ns.html?id=${GTM_ID}`}
          height="0" width="0" style="display:none;visibility:hidden"></iframe>
      </noscript>
    )}

    <!-- Accessibility: Skip link -->
    <a href="#main-content" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-primary-400 focus:text-white focus:rounded-lg focus:shadow-lg focus:outline-none focus:ring-2 focus:ring-primary-300">
      Skip to main content
    </a>
    <slot />

    <style is:global>
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border-width: 0;
      }

      .sr-only:focus {
        position: absolute;
        width: auto;
        height: auto;
        padding: 0.5rem 1rem;
        margin: 0;
        overflow: visible;
        clip: auto;
        white-space: normal;
      }

      html {
        scroll-behavior: smooth;
      }

      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      @keyframes float {
        0%, 100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      .animate-on-scroll {
        animation: fadeInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        opacity: 0;
      }

      .delay-100 { animation-delay: 0.1s; }
      .delay-200 { animation-delay: 0.2s; }
      .delay-300 { animation-delay: 0.3s; }
      .delay-400 { animation-delay: 0.4s; }

      button, a {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .bg-gradient-to-br,
      .bg-gradient-to-r,
      .bg-gradient-to-l {
        background-size: 200% 200%;
        transition: background-position 0.5s ease;
      }

      [class*="rounded-"] {
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                    box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1),
                    border-color 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      @media (prefers-reduced-motion: reduce) {
        *,
        *::before,
        *::after {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
          scroll-behavior: auto !important;
        }
      }
    </style>
  </body>
</html>
